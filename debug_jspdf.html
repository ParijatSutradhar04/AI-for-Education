<!DOCTYPE html>
<html>
<head>
    <title>jsPDF Debug</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>jsPDF Library Debug</h1>
    <div id="status"></div>
    <button onclick="checkLibrary()">Check Library</button>
    <button onclick="testSimplePDF()">Test Simple PDF</button>
    <button onclick="testComplexPDF()">Test Complex PDF</button>

    <script>
        function updateStatus(message) {
            document.getElementById('status').innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }

        function checkLibrary() {
            document.getElementById('status').innerHTML = '';
            updateStatus('=== CHECKING JSPDF LIBRARY ===');
            
            updateStatus('window object keys: ' + Object.keys(window).filter(k => k.toLowerCase().includes('pdf')));
            updateStatus('window.jspdf: ' + typeof window.jspdf);
            
            if (window.jspdf) {
                updateStatus('window.jspdf keys: ' + Object.keys(window.jspdf));
                updateStatus('window.jspdf.jsPDF: ' + typeof window.jspdf.jsPDF);
            }
            
            try {
                const { jsPDF } = window.jspdf;
                updateStatus('Destructured jsPDF: ' + typeof jsPDF);
                updateStatus('jsPDF constructor: ' + jsPDF);
            } catch (e) {
                updateStatus('Error destructuring: ' + e.message);
            }
        }

        function testSimplePDF() {
            updateStatus('=== TESTING SIMPLE PDF ===');
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
                updateStatus('PDF object created successfully');
                
                pdf.text('Hello World', 10, 10);
                updateStatus('Text added to PDF');
                
                pdf.save('simple-test.pdf');
                updateStatus('PDF save() called - download should start');
                
            } catch (error) {
                updateStatus('ERROR: ' + error.message);
                updateStatus('Stack: ' + error.stack);
            }
        }

        function testComplexPDF() {
            updateStatus('=== TESTING COMPLEX PDF ===');
            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
                let yPos = 20;
                
                // Title
                pdf.setFontSize(16);
                pdf.setFont(undefined, 'bold');
                pdf.text('Test Complex PDF', 20, yPos);
                yPos += 25;
                
                // Add some content similar to our app
                for (let i = 1; i <= 3; i++) {
                    pdf.setFontSize(12);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(`Note ${i} - ${new Date().toLocaleTimeString()}`, 20, yPos);
                    yPos += 15;
                    
                    pdf.setFontSize(10);
                    pdf.setFont(undefined, 'bold');
                    const questionText = `Q: This is test question number ${i}?`;
                    const questionLines = pdf.splitTextToSize(questionText, 170);
                    pdf.text(questionLines, 20, yPos);
                    yPos += questionLines.length * 6 + 5;
                    
                    pdf.setFont(undefined, 'normal');
                    const responseText = `A: This is a test response for question ${i}. It contains multiple sentences to test text wrapping and formatting. The response should be displayed properly in the PDF output.`;
                    const responseLines = pdf.splitTextToSize(responseText, 170);
                    pdf.text(responseLines, 20, yPos);
                    yPos += responseLines.length * 6 + 20;
                }
                
                updateStatus('Complex PDF created successfully');
                pdf.save('complex-test.pdf');
                updateStatus('Complex PDF save() called - download should start');
                
            } catch (error) {
                updateStatus('ERROR: ' + error.message);
                updateStatus('Stack: ' + error.stack);
            }
        }

        // Auto-check on load
        window.onload = function() {
            setTimeout(checkLibrary, 500);
        };
    </script>
</body>
</html>
